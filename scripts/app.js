"use strict";var _slicedToArray=function(){function e(e,t){var a=[],n=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(s){o=!0,r=s}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw r}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),URL="https://richardsoderman.se/bennygo",initMap=function(e){var t={zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(56.67575,16.337335),scrollwheel:!1,draggable:!1,disableDefaultUI:!1,zoomControl:!1,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#00FFFF"},{visibility:"on"}]}]};return new google.maps.Map(document.getElementById("map"),t)},getSavedKey=function(){return localStorage.getItem("key")},saveUserKey=function(e){localStorage.setItem("key",e)},placeMarkers=function(e,t){return t.map(function(t,a){var n=new google.maps.Marker({map:e,metadata:{type:"point",id:"marker"+a},markerId:t.markerId,draggable:!1,optimized:t.optimized,animation:google.maps.Animation.DROP,position:new google.maps.LatLng(t.lat,t.lng),icon:new google.maps.MarkerImage(t.url,null,null,null,new google.maps.Size(t.width,t.height))});return n})},getMyPosition=function(){return new Promise(function(e,t){window.navigator.geolocation?window.navigator.geolocation.getCurrentPosition(function(t){var a={lat:t.coords.latitude,lng:t.coords.longitude};e(a)},function(e){t(e)}):t(!1)})},getUserData=function(e,t){return new Promise(function(a,n){var o=new XMLHttpRequest(null);o.open(e,t,!0),o.addEventListener("load",function(e){a(JSON.parse(this.response))}),o.addEventListener("error",function(){n("connection error")}),o.addEventListener("timeout",function(){n("timeout")}),o.send()})},markerClick=function(e,t,a,n,o){if(a.contains(n)){var r=getSavedKey();getUserData("POST",URL+"/api/catch/"+t.markerId+"?key="+r).then(function(e){o.$data.name=t.markerId,o.$data.showCongrats=!0,t.setMap(null),o.$data.nrOfCaught+=1})["catch"](function(e){console.log(e)})}},placeMyPosition=function(e,t){var a=new google.maps.Marker({map:e,draggable:!1,optimized:!0,position:new google.maps.LatLng(t.lat,t.lng)}),n=new google.maps.Circle({map:e,draggable:!1,radius:40,fillColor:"#00FFFF",strokeColor:"#00FFFF"});return n.bindTo("center",a,"position"),a.addListener("click",function(e){console.log("This is my position")}),[a,n]},addMarkerClick=function(e,t,a,n,o){return google.maps.event.addListener(e,"click",function(r){markerClick(r,e,t,new google.maps.LatLng(a,n),o)})},removeMarkerClick=function(e){google.maps.event.removeListener(e)},updatePosition=function(e,t,a,n,o,r){return setInterval(function(){getMyPosition().then(function(i){t.setMap(null),a.setMap(null),o.map(function(e){removeMarkerClick(e)});var l=placeMyPosition(e,i),s=_slicedToArray(l,2),u=s[0],c=s[1];t=u,a=c,o=n.map(function(e){return addMarkerClick(e,a,e.position.lat(),e.position.lng(),r)}),e.setCenter(new google.maps.LatLng(i.lat,i.lng))})},5e3)},objectToArray=function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&(e[a].markerId=a,t.push(e[a]));return t},objectNamesToArray=function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(a);return t},removeCaughtMarkers=function(e,t){var a=objectNamesToArray(e);return t.filter(function(e){for(var t=0;t<a.length;t++)if(a[t]===e.markerId)return!1;return!0})},vueComponents=function(){Vue.component("catch",{template:"#modal-template-catch",props:{display:{type:Boolean,required:!0,twoWay:!0},gifname:{type:String,required:!0,twoWay:!0}}}),Vue.component("info",{template:"#modal-template-intro",props:{display:{type:Boolean,required:!0,twoWay:!0}}}),Vue.component("modal",{template:"#modal-template",props:{show:{type:Boolean,required:!0,twoWay:!0},gifs:{type:Object,required:!0,twoWay:!0},gifscaught:{type:Number,required:!0,twoWay:!0},totalgifs:{type:Number,required:!0,twoWay:!0}}})},vueNav=function(e,t){return new Vue({el:"#nav",data:{nrOfCaught:e,totalGifs:0,showGallery:!1,gifsCaught:{},showIntro:!1,name:"",showCongrats:!1},methods:{galleryClick:function(){var e=this,t=getSavedKey();getUserData("GET",URL+"/api/user/"+t).then(function(t){e.$data.gifsCaught=t.data.gifsCaught?t.data.gifsCaught:{},e.$data.nrOfCaught=t.data.nfOfCaught,e.$data.totalGifs=objectToArray(t.allGifs).length})["catch"](function(e){}),this.$data.showGallery=!0},galleryIntroClick:function(){this.$data.showIntro=!0},okClick:function(e){this.$data.name=e,this.$data.showCongrats=!1},logoClick:function(){t.setZoom(16)}},attached:function(){}})},init=function(){google.maps.Circle.prototype.contains=function(e){return this.getBounds().contains(e)&&google.maps.geometry.spherical.computeDistanceBetween(this.getCenter(),e)<=this.getRadius()},vueComponents();var e=initMap(),t=getSavedKey();getUserData("GET",URL+"/api/user/"+t).then(function(a){var n=vueNav(a.data.nfOfCaught,e);t||(n.$data.showIntro=!0),saveUserKey(a.key);var o=objectToArray(a.allGifs);a.data.hasOwnProperty("gifsCaught")&&(o=removeCaughtMarkers(a.data.gifsCaught,objectToArray(a.allGifs)));var r=placeMarkers(e,o);getMyPosition().then(function(t){e.setCenter(new google.maps.LatLng(t.lat,t.lng));var a=placeMyPosition(e,t),o=_slicedToArray(a,2),i=o[0],l=o[1],s=r.map(function(e){return addMarkerClick(e,l,e.position.lat(),e.position.lng(),n)});updatePosition(e,i,l,r,s,n)})})["catch"](function(e){console.log(e)})};window.onload=init;
